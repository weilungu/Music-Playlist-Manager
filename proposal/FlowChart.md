# 音樂播放清單管理器 - 系統流程圖

## � 流程圖說明
本文檔包含 3 個核心流程圖，展示系統的完整運作邏輯。

---

## 📊 流程圖 1：應用程式完整生命周期

```
┌─────────────────────────────────────────────────────────────────┐
│                   使用者載入 index.html                         │
└──────────────────────────┬──────────────────────────────────────┘
                           │
        ┌──────────────────┴──────────────────┐
        │                                     │
        ▼                                     ▼
┌────────────────────────┐          ┌──────────────────────┐
│ 初始化核心系統         │          │ 初始化 UI 介面       │
└────────┬───────────────┘          └──────────┬───────────┘
         │                                     │
    ┌────┴────────┐                      ┌────┴────────┐
    ▼             ▼                      ▼             ▼
┌─────────┐  ┌──────────┐        ┌──────────┐  ┌─────────┐
│IndexedDB│  │localStorage       │HTML 元素 │  │CSS 樣式 │
│初始化   │  │載入資料  │        │綁定      │  │應用     │
└─────────┘  └──────────┘        └──────────┘  └─────────┘
    │             │                  │             │
    └────┬────────┘                  └────┬────────┘
         │                                │
         ▼                                ▼
┌────────────────────────────────────────────┐
│ 重建搜尋索引 (SearchIndexMap)              │
└────────────┬─────────────────────────────┘
             │
             ▼
┌────────────────────────────────────────────┐
│ 初始化控制器                               │
│ • PlayerController (播放邏輯)              │
│ • PlaylistController (清單邏輯)           │
└────────────┬─────────────────────────────┘
             │
             ▼
┌────────────────────────────────────────────┐
│ 綁定事件監聽器                             │
│ • 按鈕點擊事件                             │
│ • 表單提交事件                             │
│ • 音訊播放事件                             │
└────────────┬─────────────────────────────┘
             │
             ▼
┌────────────────────────────────────────────┐
│ ✅ 應用程式準備完成                        │
│    等待使用者操作                          │
└────────────────────────────────────────────┘
```

---

## 🎵 流程圖 2：播放清單與播放控制流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        使用者操作                               │
└──────────────────────┬──────────────────────────────────────────┘
                       │
    ┌──────────────────┼──────────────────┬──────────────────┐
    │                  │                  │                  │
    ▼                  ▼                  ▼                  ▼
┌────────────┐   ┌─────────────┐   ┌──────────────┐   ┌──────────┐
│ 新增歌曲   │   │ 刪除歌曲    │   │ 搜尋歌曲     │   │播放控制  │
│ (add)      │   │ (remove)    │   │ (search)     │   │(play...)│
└─────┬──────┘   └──────┬──────┘   └───────┬──────┘   └────┬─────┘
      │                 │                  │              │
      ▼                 ▼                  ▼              ▼
┌──────────────────────────────┐    ┌──────────────────────┐
│ 驗證輸入資料                 │    │ 更新播放索引        │
│ • 曲名、歌手、時長         │    │ (currentIndex)       │
│ • 歌曲是否存在             │    └────────┬─────────────┘
│ • 關鍵字不為空             │           │
└──────────┬───────────────────┘           ▼
           │                   ┌──────────────────────┐
           ▼                   │ 從 LinkedList 取得  │
┌──────────────────────────────┐│ 當前歌曲物件       │
│ 資料結構操作                  ││ (currentSong)       │
│ • LinkedList: insert/delete   │└────────┬──────────┘
│ • HashTable: add/lookup       │        │
│ • BinarySearchTree: sort      │        ▼
└──────────┬───────────────────┘┌──────────────────────┐
           │                    │ 播放音訊             │
           ▼                    │ • 加載音訊檔案      │
┌──────────────────────────────┐│ • 設置時間/音量     │
│ 更新本地資料                  ││ • 觸發播放事件     │
│ • localStorage (播放清單)     │└────────┬──────────┘
│ • IndexedDB (音訊檔案)        │        │
│ • 搜尋索引 (SearchIndex)      │        ▼
└──────────┬───────────────────┘┌──────────────────────┐
           │                    │ 更新 UI 顯示        │
           └────┬───────────────┤ • 歌曲資訊          │
                │               │ • 進度條            │
                └───────┬────────┤ • 播放按鈕狀態     │
                        │       │ • 搜尋結果          │
                        ▼       └─────────────────────┘
                 ┌──────────────┐
                 │ ✅ 操作完成   │
                 │ 顯示成功/失敗 │
                 └──────────────┘
```

---

## 💾 流程圖 3：資料持久化與轉換流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        資料操作事件                             │
│  (新增歌曲、刪除歌曲、上傳音訊、應用啟動、應用關閉)            │
└──────────────────────┬──────────────────────────────────────────┘
                       │
       ┌───────────────┼───────────────┬───────────────┐
       │               │               │               │
       ▼               ▼               ▼               ▼
┌────────────┐   ┌──────────┐   ┌──────────────┐   ┌──────────┐
│ 播放清單   │   │ 音訊檔案 │   │搜尋索引      │   │排序設定  │
│資料        │   │          │   │              │   │          │
└─────┬──────┘   └────┬─────┘   └────┬─────────┘   └────┬─────┘
      │               │              │                 │
      ▼               ▼              ▼                 ▼
┌──────────────┐ ┌────────────┐ ┌─────────────┐ ┌─────────────┐
│JSON 序列化   │ │FileReader  │ │雜湊表序列化 │ │字符串序列化 │
│             │ │readAsArray │ │             │ │             │
│             │ │→ Binary    │ │             │ │             │
└──────┬───────┘ └─────┬──────┘ └─────┬───────┘ └─────┬───────┘
       │               │              │               │
       ▼               ▼              ▼               ▼
┌──────────────────────────────────────────────────────────────┐
│                     資料編碼轉換                            │
├──────────────────────────────────────────────────────────────┤
│ • 播放清單 → JSON.stringify() → 字符串                      │
│ • 音訊檔案 → Base64 encode → 文本形式                       │
│ • 搜尋索引 → JSON.stringify() → 字符串                      │
│ • 排序設定 → 直接字符串                                    │
└──────────────┬───────────────────────────────────────────────┘
               │
        ┌──────┴──────┬──────────────────┐
        │             │                  │
        ▼             ▼                  ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│localStorage  │ │ IndexedDB    │ │ 記憶體快取   │
│ (輕量資料)   │ │ (大型檔案)   │ │ (臨時資料)  │
└──────┬───────┘ └──────┬───────┘ └──────────────┘
       │                │
       ├────────┬───────┘
       │        │
       ▼        ▼
┌──────────────────────────────────────┐
│  應用程式重新啟動時                  │
└────────────┬───────────────────────┘
             │
    ┌────────┴────────┐
    ▼                 ▼
┌─────────────┐  ┌──────────────┐
│localStorage │  │ IndexedDB    │
│讀取並解析   │  │讀取並解析    │
└──────┬──────┘  └──────┬───────┘
       │                │
       ▼                ▼
┌──────────────┐  ┌──────────────┐
│JSON.parse()  │  │Base64.decode │
│← 復原資料    │  │← 復原檔案    │
└──────┬───────┘  └──────┬───────┘
       │                │
       └────────┬───────┘
                ▼
       ┌─────────────────┐
       │ ✅ 資料恢復成功 │
       │ 應用程式就緒    │
       └─────────────────┘
```

---

## 📋 系統特性與資料結構速查表

### 核心資料結構
| 資料結構 | 用途 | 主要操作複雜度 |
|---------|------|--------------|
| **LinkedList** | 主播放清單 | 插入 O(1)、刪除 O(n)、查詢 O(n) |
| **HashTable** | 快速搜尋索引 | 查詢 O(1)、新增 O(1) |
| **BinarySearchTree** | 排序/查詢 | 插入 O(log n)、查詢 O(log n) |
| **Queue** | 即將播放隊列 | 入隊 O(1)、出隊 O(1) |

### 儲存機制
| 儲存方式 | 容量 | 適用資料 | 讀取時間 |
|---------|------|--------|--------|
| **localStorage** | ~5-10MB | 播放清單、設定、搜尋索引 | 同步 |
| **IndexedDB** | ~50MB+ | 音訊檔案、大型資料集 | 非同步 |
| **記憶體** | 系統限制 | 當前播放狀態、快取 | 即時 |

### 主要功能流程
1. **新增歌曲** → 驗證 → LinkedList 插入 → HashTable 更新 → 存儲
2. **搜尋歌曲** → 關鍵字驗證 → HashTable 查詢 (O(1)) → UI 更新
3. **播放控制** → 更新索引 → 加載音訊 → Audio API → UI 同步
4. **資料載入** → localStorage/IndexedDB 讀取 → 資料解析 → 重建索引

### 事件監聽機制
- **UI 事件** → 按鈕點擊、表單提交、搜尋輸入
- **播放事件** → 播放中、已暫停、已結束、時間更新
- **儲存事件** → 資料變更自動同步到 localStorage/IndexedDB

---

## 💡 系統特性說明

### 📌 主要功能
- ✅ 播放清單管理 (新增/刪除/搜尋)
- ✅ 音樂播放控制 (播放/暫停/上一首/下一首)
- ✅ 隨機播放功能
- ✅ 進度條顯示
- ✅ 本地資料持久化
- ✅ 音訊檔案管理

### ⚙️ 技術棧
- **前端**: HTML5, CSS3, Vanilla JavaScript
- **儲存**: localStorage (播放清單) + IndexedDB (音訊檔案)
- **資料結構**: LinkedList, HashTable, Queue, BinarySearchTree
- **API**: Web Audio API, FileReader API

### 🎯 效能優化
- LinkedList: O(1) 插入操作
- HashTable: O(1) 搜尋操作  
- BinarySearchTree: O(log n) 排序查詢
- 快取系統: 最大歌手編號、搜尋索引

